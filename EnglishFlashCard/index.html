<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#667eea">
    <title>üé§ Voice Flashcards (Debug)</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIlZvaWNlIEZsYXNoY2FyZHMiLAogICJzaG9ydF9uYW1lIjogIkZsYXNoY2FyZHMiLAogICJzdGFydF91cmwiOiAiLiIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiIzY2N2VlYSIsCiAgInRoZW1lX2NvbG9yIjogIiM2NjdlZWEiLAogICJpY29ucyI6IFt7InNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWwsJTNDc3ZnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Zycgdmlld0JveD0nMCAwIDEwMCAxMDAnJTNFJTNDdGV4dCB5PScuOWVtJyBmb250LXNpemU9JzkwJyUzRSVGMCU5RiU4RSVBNCUzQy90ZXh0JTNFJTNDL3N2ZyUzRSIsICJzaXplcyI6ICIxOTJ4MTkyIiwgInR5cGUiOiAiaW1hZ2Uvc3ZnK3htbCJ9XQp9">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            padding-bottom: 100px;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        
        .card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .security-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 16px;
        }
        
        .debug-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            margin-left: 8px;
        }
        
        h1 {
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #666;
            font-size: 14px;
        }
        
        .mode-selector {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .mode-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            font-size: 14px;
        }
        
        .mode-btn.active {
            background: #667eea;
            color: white;
        }
        
        .mode-btn.inactive {
            background: #e0e0e0;
            color: #666;
        }
        
        .mic-button {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: none;
            background: #667eea;
            color: white;
            font-size: 48px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            transition: all 0.3s;
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }
        
        .mic-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .mic-button.listening {
            background: #ef4444;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .result-box {
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        
        .result-box.question {
            background: #f3f4f6;
        }
        
        .result-box.answer {
            background: #d1fae5;
        }
        
        .result-box.error {
            background: #fee2e2;
            border: 2px solid #ef4444;
        }
        
        .label {
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-success {
            background: #10b981;
            color: white;
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        
        .btn-warning {
            background: #fbbf24;
            color: #92400e;
        }
        
        .flashcard-item {
            padding: 15px;
            background: #f9fafb;
            border-radius: 10px;
            margin-bottom: 10px;
            position: relative;
            padding-right: 50px;
        }
        
        .delete-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 18px;
        }
        
        .settings-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: white;
            border: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            cursor: pointer;
            font-size: 24px;
        }
        
        .input-field {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            margin: 10px 0;
        }
        
        .practice-card {
            min-height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f9fafb;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            font-size: 20px;
            line-height: 1.6;
            text-align: center;
        }
        
        .security-info {
            background: #f0f9ff;
            border-left: 4px solid #3b82f6;
            padding: 12px;
            margin: 16px 0;
            border-radius: 8px;
            font-size: 13px;
            color: #1e40af;
        }
        
        .error-details {
            background: #fee2e2;
            border-left: 4px solid #ef4444;
            padding: 12px;
            margin: 16px 0;
            border-radius: 8px;
            font-size: 12px;
            color: #991b1b;
            font-family: monospace;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .hidden {
            display: none;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .loading {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="card">
            <div>
                <span class="security-badge">üîí Encrypted Storage</span>
                <span class="debug-badge">üêõ Debug Mode</span>
            </div>
            <h1>üé§ Voice Flashcards</h1>
            <p class="subtitle">Speak Persian or English - Get polished translations!</p>
            
            <div class="mode-selector">
                <button class="mode-btn active" onclick="setMode('create')">
                    ‚úèÔ∏è Create Cards
                </button>
                <button class="mode-btn inactive" onclick="setMode('practice')">
                    üéÆ Practice (<span id="cardCount">0</span>)
                </button>
            </div>
        </div>
        
        <!-- Settings Panel -->
        <div id="settingsPanel" class="card hidden">
            <h3>‚öôÔ∏è API Settings</h3>
            
            <div class="security-info">
                üîí <strong>Your API key is encrypted</strong> before storage. Debug mode will show detailed error messages.
            </div>
            
            <p class="subtitle">
                Get your free Gemini API key from: 
                <a href="https://aistudio.google.com/app/apikey" target="_blank" style="color: #667eea;">
                    Google AI Studio
                </a>
            </p>
            <input type="password" id="apiKeyInput" class="input-field" placeholder="Paste your API key here (starts with AIza...)">
            
            <button class="btn btn-warning" onclick="testApiKey()" style="margin-bottom: 10px;">
                üß™ Test API Key
            </button>
            
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-primary" onclick="saveApiKey()">Save Key</button>
                <button class="btn" style="background: #e0e0e0; color: #666;" onclick="toggleSettings()">Cancel</button>
            </div>
        </div>
        
        <!-- Create Mode -->
        <div id="createMode">
            <!-- Voice Input -->
            <div class="card" style="text-align: center;">
                <button id="micButton" class="mic-button" onclick="startListening()">
                    üé§
                </button>
                <p id="statusText" style="margin-top: 20px; color: #666; font-size: 14px;">
                    Tap to speak in Persian or English
                </p>
                <button id="needKeyBtn" class="btn btn-warning hidden" style="margin-top: 10px;" onclick="toggleSettings()">
                    ‚ö†Ô∏è Add API Key First
                </button>
            </div>
            
            <!-- Results -->
            <div id="resultsCard" class="card hidden">
                <div id="transcriptBox" class="hidden">
                    <div class="label" style="color: #667eea;">YOUR SPEECH:</div>
                    <div class="result-box question" id="transcriptText"></div>
                </div>
                
                <div id="loadingBox" class="hidden" style="text-align: center; padding: 20px;">
                    <div class="loading" style="font-size: 32px;">‚è≥</div>
                    <p style="color: #667eea;">Getting translation...</p>
                </div>
                
                <div id="errorBox" class="hidden">
                    <div class="label" style="color: #ef4444;">‚ùå ERROR:</div>
                    <div class="result-box error" id="errorMessage"></div>
                    <div class="error-details" id="errorDetails"></div>
                    <button class="btn btn-warning" onclick="toggleSettings()" style="margin-top: 10px;">
                        Check API Key Settings
                    </button>
                </div>
                
                <div id="translationBox" class="hidden">
                    <div class="label" style="color: #10b981;">‚ú® POLISHED ENGLISH:</div>
                    <div class="result-box answer" id="translationText"></div>
                    <button class="btn btn-success" onclick="saveFlashcard()">
                        ‚ûï Save as Flashcard
                    </button>
                </div>
            </div>
            
            <!-- Flashcards List -->
            <div id="flashcardsList" class="card hidden">
                <h3>üìö Your Flashcards (<span id="listCount">0</span>)</h3>
                <div id="cardsContainer"></div>
            </div>
        </div>
        
        <!-- Practice Mode -->
        <div id="practiceMode" class="card hidden">
            <div id="practiceProgress" style="text-align: center; color: #667eea; font-weight: bold; margin-bottom: 20px;">
                Card <span id="currentCard">1</span> of <span id="totalCards">0</span>
            </div>
            
            <div class="practice-card" id="practiceCardContent">
                <div id="practiceQuestion"></div>
                <div id="practiceAnswer" class="hidden"></div>
            </div>
            
            <button id="showAnswerBtn" class="btn btn-primary" onclick="showAnswer()">
                Show Answer
            </button>
            <button id="nextCardBtn" class="btn btn-success hidden" onclick="nextCard()">
                ‚úì Next Card
            </button>
        </div>
    </div>
    
    <!-- Settings Button -->
    <button id="settingsBtn" class="settings-btn" onclick="toggleSettings()">‚öôÔ∏è</button>
    
    <script>
        // Simple encryption/decryption
        function getDeviceFingerprint() {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            ctx.textBaseline = 'top';
            ctx.font = '14px Arial';
            ctx.fillText('fingerprint', 2, 2);
            return canvas.toDataURL().slice(-50);
        }
        
        function simpleEncrypt(text, key) {
            let encrypted = '';
            for (let i = 0; i < text.length; i++) {
                encrypted += String.fromCharCode(
                    text.charCodeAt(i) ^ key.charCodeAt(i % key.length)
                );
            }
            return btoa(encrypted);
        }
        
        function simpleDecrypt(encrypted, key) {
            try {
                const decoded = atob(encrypted);
                let decrypted = '';
                for (let i = 0; i < decoded.length; i++) {
                    decrypted += String.fromCharCode(
                        decoded.charCodeAt(i) ^ key.charCodeAt(i % key.length)
                    );
                }
                return decrypted;
            } catch {
                return null;
            }
        }
        
        // Global state
        let state = {
            mode: 'create',
            flashcards: [],
            apiKey: '',
            transcript: '',
            translation: '',
            currentCardIndex: 0,
            showingAnswer: false,
            isListening: false,
            deviceKey: getDeviceFingerprint()
        };
        
        // Load saved data
        function loadData() {
            const savedCards = localStorage.getItem('flashcards');
            const encryptedKey = localStorage.getItem('geminiApiKey_enc');
            
            if (savedCards) {
                state.flashcards = JSON.parse(savedCards);
                updateCardCount();
                renderFlashcards();
            }
            
            if (encryptedKey) {
                const decrypted = simpleDecrypt(encryptedKey, state.deviceKey);
                if (decrypted) {
                    state.apiKey = decrypted;
                    document.getElementById('apiKeyInput').value = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢' + decrypted.slice(-8);
                }
            }
            
            checkApiKey();
        }
        
        function checkApiKey() {
            const needKeyBtn = document.getElementById('needKeyBtn');
            if (!state.apiKey) {
                needKeyBtn.classList.remove('hidden');
            } else {
                needKeyBtn.classList.add('hidden');
            }
        }
        
        function toggleSettings() {
            const panel = document.getElementById('settingsPanel');
            const btn = document.getElementById('settingsBtn');
            panel.classList.toggle('hidden');
            btn.classList.toggle('hidden');
        }
        
        function saveApiKey() {
            const key = document.getElementById('apiKeyInput').value.trim();
            if (key && !key.startsWith('‚Ä¢‚Ä¢‚Ä¢‚Ä¢')) {
                if (!key.startsWith('AIza')) {
                    alert('‚ö†Ô∏è Warning: Gemini API keys usually start with "AIza". Please verify your key.');
                }
                state.apiKey = key;
                const encrypted = simpleEncrypt(key, state.deviceKey);
                localStorage.setItem('geminiApiKey_enc', encrypted);
                alert('API key saved and encrypted! üîí‚úÖ\n\nClick "Test API Key" to verify it works.');
                checkApiKey();
            } else if (state.apiKey) {
                toggleSettings();
            } else {
                alert('Please enter an API key');
            }
        }
        
        // Test API Key function
        async function testApiKey() {
            const key = document.getElementById('apiKeyInput').value.trim();
            const testKey = key.startsWith('‚Ä¢‚Ä¢‚Ä¢‚Ä¢') ? state.apiKey : key;
            
            if (!testKey) {
                alert('Please enter an API key first!');
                return;
            }
            
            alert('Testing API key... Please wait.');
            
            try {
                const response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${testKey}`,
                    {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{ text: "Say 'Hello'" }]
                            }]
                        })
                    }
                );
                
                const data = await response.json();
                
                if (response.ok && data.candidates && data.candidates[0]) {
                    alert('‚úÖ SUCCESS! Your API key is working correctly!\n\nResponse: ' + data.candidates[0].content.parts[0].text);
                } else if (response.status === 400) {
                    alert('‚ùå ERROR: Bad Request\n\nYour API key format may be incorrect. Make sure you copied the entire key from Google AI Studio.');
                } else if (response.status === 403) {
                    alert('‚ùå ERROR: Permission Denied\n\nYour API key may not have permission to use the Gemini API. Try creating a new key at: https://aistudio.google.com/app/apikey');
                } else if (response.status === 429) {
                    alert('‚ùå ERROR: Rate Limit Exceeded\n\nYou\'ve made too many requests. Wait a minute and try again.');
                } else {
                    alert('‚ùå ERROR: ' + response.status + '\n\n' + JSON.stringify(data, null, 2));
                }
            } catch (error) {
                alert('‚ùå NETWORK ERROR\n\nCould not connect to Google API. Check your internet connection.\n\nError: ' + error.message);
            }
        }
        
        function setMode(mode) {
            state.mode = mode;
            
            const buttons = document.querySelectorAll('.mode-btn');
            buttons[0].className = mode === 'create' ? 'mode-btn active' : 'mode-btn inactive';
            buttons[1].className = mode === 'practice' ? 'mode-btn active' : 'mode-btn inactive';
            
            document.getElementById('createMode').classList.toggle('hidden', mode !== 'create');
            document.getElementById('practiceMode').classList.toggle('hidden', mode !== 'practice');
            
            if (mode === 'practice') {
                if (state.flashcards.length === 0) {
                    alert('Create some flashcards first!');
                    setMode('create');
                    return;
                }
                startPractice();
            }
        }
        
        function startListening() {
            if (!state.apiKey) {
                alert('Please add your Gemini API key in settings first!');
                toggleSettings();
                return;
            }
            
            if (!('webkitSpeechRecognition' in window)) {
                alert('Sorry, your browser doesn\'t support voice input. Try Safari or Chrome.');
                return;
            }
            
            const recognition = new webkitSpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'fa-IR';
            
            recognition.onstart = () => {
                state.isListening = true;
                document.getElementById('micButton').classList.add('listening');
                document.getElementById('micButton').textContent = 'üî¥';
                document.getElementById('statusText').textContent = 'üé§ Listening...';
            };
            
            recognition.onresult = (event) => {
                const spokenText = event.results[0][0].transcript;
                state.transcript = spokenText;
                showTranscript();
                getTranslation(spokenText);
            };
            
            recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                resetMicButton();
                alert('Speech Error: ' + event.error);
            };
            
            recognition.onend = () => {
                resetMicButton();
            };
            
            recognition.start();
        }
        
        function resetMicButton() {
            state.isListening = false;
            document.getElementById('micButton').classList.remove('listening');
            document.getElementById('micButton').textContent = 'üé§';
            document.getElementById('statusText').textContent = 'Tap to speak in Persian or English';
        }
        
        function showTranscript() {
            document.getElementById('resultsCard').classList.remove('hidden');
            document.getElementById('transcriptBox').classList.remove('hidden');
            document.getElementById('transcriptText').textContent = state.transcript;
            document.getElementById('errorBox').classList.add('hidden');
        }
        
        async function getTranslation(text) {
            document.getElementById('loadingBox').classList.remove('hidden');
            document.getElementById('translationBox').classList.add('hidden');
            document.getElementById('errorBox').classList.add('hidden');
            
            try {
                const response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${state.apiKey}`,
                    {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: `Translate this to natural, polished English. If it's already English, improve it to sound more natural and fluent. Only provide the translation, nothing else:\n\n"${text}"`
                                }]
                            }]
                        })
                    }
                );
                
                const data = await response.json();
                
                console.log('API Response:', data);
                
                if (!response.ok) {
                    showError(
                        `API Error (${response.status})`,
                        `Status: ${response.status}\n\n` +
                        `Response: ${JSON.stringify(data, null, 2)}\n\n` +
                        `Possible causes:\n` +
                        `- Invalid API key\n` +
                        `- API quota exceeded\n` +
                        `- API key lacks permissions\n\n` +
                        `Try clicking "Test API Key" in settings.`
                    );
                    return;
                }
                
                if (data.candidates && data.candidates[0] && data.candidates[0].content && data.candidates[0].content.parts && data.candidates[0].content.parts[0]) {
                    state.translation = data.candidates[0].content.parts[0].text.trim();
                    showTranslation();
                } else {
                    showError(
                        'Unexpected API response format',
                        `The API returned data but in an unexpected format.\n\n` +
                        `Full response:\n${JSON.stringify(data, null, 2)}\n\n` +
                        `This might mean:\n` +
                        `- The API format changed\n` +
                        `- Content was blocked by safety filters\n` +
                        `- API quota issue`
                    );
                }
            } catch (error) {
                console.error('Translation error:', error);
                showError(
                    'Network or connection error',
                    `Error: ${error.message}\n\n` +
                    `Stack: ${error.stack}\n\n` +
                    `This usually means:\n` +
                    `- No internet connection\n` +
                    `- Network firewall blocking the request\n` +
                    `- CORS issue\n\n` +
                    `Check your internet connection and try again.`
                );
            }
            
            document.getElementById('loadingBox').classList.add('hidden');
        }
        
        function showError(message, details) {
            document.getElementById('errorBox').classList.remove('hidden');
            document.getElementById('translationBox').classList.add('hidden');
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('errorDetails').textContent = details;
        }
        
        function showTranslation() {
            document.getElementById('translationBox').classList.remove('hidden');
            document.getElementById('errorBox').classList.add('hidden');
            document.getElementById('translationText').textContent = state.translation;
        }
        
        function saveFlashcard() {
            if (!state.transcript || !state.translation) {
                alert('Need both question and translation!');
                return;
            }
            
            const newCard = {
                id: Date.now(),
                question: state.transcript,
                answer: state.translation,
                created: new Date().toISOString(),
                reviewCount: 0
            };
            
            state.flashcards.unshift(newCard);
            localStorage.setItem('flashcards', JSON.stringify(state.flashcards));
            
            state.transcript = '';
            state.translation = '';
            document.getElementById('resultsCard').classList.add('hidden');
            document.getElementById('transcriptBox').classList.add('hidden');
            document.getElementById('translationBox').classList.add('hidden');
            
            updateCardCount();
            renderFlashcards();
            
            alert('Flashcard saved! üéâ');
        }
        
        function updateCardCount() {
            document.getElementById('cardCount').textContent = state.flashcards.length;
            document.getElementById('listCount').textContent = state.flashcards.length;
            
            if (state.flashcards.length > 0) {
                document.getElementById('flashcardsList').classList.remove('hidden');
            }
        }
        
        function renderFlashcards() {
            const container = document.getElementById('cardsContainer');
            container.innerHTML = '';
            
            state.flashcards.forEach(card => {
                const cardEl = document.createElement('div');
                cardEl.className = 'flashcard-item';
                cardEl.innerHTML = `
                    <div style="font-size: 14px; color: #666; margin-bottom: 8px;">
                        Q: ${card.question}
                    </div>
                    <div style="font-size: 14px; color: #10b981; font-weight: bold;">
                        A: ${card.answer}
                    </div>
                    <button class="delete-btn" onclick="deleteCard(${card.id})">üóëÔ∏è</button>
                `;
                container.appendChild(cardEl);
            });
        }
        
        function deleteCard(id) {
            if (confirm('Delete this flashcard?')) {
                state.flashcards = state.flashcards.filter(card => card.id !== id);
                localStorage.setItem('flashcards', JSON.stringify(state.flashcards));
                updateCardCount();
                renderFlashcards();
            }
        }
        
        function startPractice() {
            state.currentCardIndex = 0;
            state.showingAnswer = false;
            showPracticeCard();
        }
        
        function showPracticeCard() {
            const card = state.flashcards[state.currentCardIndex];
            document.getElementById('currentCard').textContent = state.currentCardIndex + 1;
            document.getElementById('totalCards').textContent = state.flashcards.length;
            
            document.getElementById('practiceQuestion').innerHTML = `
                <div style="color: #667eea; font-size: 14px; margin-bottom: 10px;">QUESTION:</div>
                ${card.question}
            `;
            document.getElementById('practiceAnswer').innerHTML = `
                <div style="color: #10b981; font-size: 14px; margin-bottom: 10px;">ANSWER:</div>
                ${card.answer}
            `;
            
            document.getElementById('practiceQuestion').classList.remove('hidden');
            document.getElementById('practiceAnswer').classList.add('hidden');
            document.getElementById('showAnswerBtn').classList.remove('hidden');
            document.getElementById('nextCardBtn').classList.add('hidden');
        }
        
        function showAnswer() {
            document.getElementById('practiceAnswer').classList.remove('hidden');
            document.getElementById('showAnswerBtn').classList.add('hidden');
            document.getElementById('nextCardBtn').classList.remove('hidden');
        }
        
        function nextCard() {
            state.flashcards[state.currentCardIndex].reviewCount += 1;
            localStorage.setItem('flashcards', JSON.stringify(state.flashcards));
            
            if (state.currentCardIndex < state.flashcards.length - 1) {
                state.currentCardIndex++;
                showPracticeCard();
            } else {
                alert('üéâ You reviewed all cards!');
                setMode('create');
            }
        }
        
        window.onload = loadData;
    </script>
</body>
</html>
